<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Building a Statistical Language Model | nixing around</title>
<meta property="og:title" content="Building a Statistical Language Model" />
<meta name="author" content="umhau" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Update: I finished my script for creating custom language models.  See here: https://github.com/umhau/vmc.There’s a summary at the end with what I figured out.  Most of this is me thinking on paper.The statistical language model is used for helping CMU Sphinx know what words exist, and what the order the words exist in (the grammar and syntax structure).  The intro website to all this is here.I’m trying to decide between the SRILM and the MITLM packages [subsequent edit: also the logios package and the quicklm pearl script - these are referenced in hard-to-find places on the CMU website; see here and here, respectively] [another subsequent edit: looks like I found a link to the official CMU Statistical Language Model toolkit - it was buried in the QuickLM script].  S- is easier to use, apparently, and the CMU site provides example commands.  M-, however, seems more likely to stick around and be accessible on github for the long-term.  Plus, I forked it. [sorry, blogger’s formatting broke and I had to convert everything to plaintext and start over…lost the links.]Only downside is, the main contributor to MITLM stopped work on it about 6 mos ago, and started dealing with Kaldi instead.  Guess he figured the newer tech was more worth his time.  Still, dinosaurs have their place; just watch Space Cowboys to get the picture. &lt;h3&gt;MITLM&lt;/h3&gt;Just to be sure that the software doesn’t go anywhere, code is downloaded from my repository.Update: Thanks to Qi Wang’s comment below there’s an extra dependency to install:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sudo apt-get install autoconf-archive&lt;/pre&gt;Installation of MITLM:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/mitlm.gitcd ./mitlm./autogen.sh./configuremakemake install&lt;/pre&gt;So, turns out that there&#39;s some weird problems with the installation. &nbsp;Something changed, or something isn&#39;t being installed properly. &nbsp;The compilation seems to fail with these errors:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;./configure: line 19641: AX_CXX_HEADER_TR1_UNORDERED_MAP: command not found./configure: line 19642: syntax error near unexpected token `noext,&#39;./configure: line 19642: `AX_CXX_COMPILE_STDCXX_11(noext, optional)&#39;&lt;/pre&gt;g++ wasn&#39;t installed, but even after that was added it still wouldn&#39;t work.Update: Unfortunately, I’ve lost track of other dependencies involved - at some point, I’ll make a list of all the stuff I’ve installed while working on this project.  Had to install libtool (or similar?) to get here.  Mental note:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;libtoolize: error: Failed to create ‘build-aux’&lt;/pre&gt;But, that’s because I’m trying to do this on a different Mint installation from my usual - on my default workstation, that dependency is installed (no idea what it is, except that it’s probably listed somewhere on this blog). &lt;div&gt;&lt;/div&gt;After installing the extra dependency, the installation works! So this is a viable avenue thus far to get the LM working.  I’ve already made it past where I need the MITLM, though, so I’m going to let it be for now.  Might have to come back for it.&lt;h3&gt;SRILM&lt;/h3&gt;Ok, let’s see what SRILM has to offer us. It’s more inconvenient to install; ya have to go through a license agreement to download it, so I can’t just stick a bash command here.…unless I put the code on my github.  In which case, it’s easy to get a copy of.  Too bad there’s too many files to put up an extracted version, and too bad the compressed version is more than 25mb.  Time to split up the tar.gz file again; for my own records, here’s how I split it.  All I need for getting and using it is the reconstruction bit. The splitting part, given the archive file:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;split -b 24m -d srilm-1.7.1.tar.gz srilm-1.7.1.tar.gz.part-&lt;/pre&gt;Alright. Once the file is on github, it’s just more copy-pasting. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/srilm.gitcd ./srilmcat srilm-1.7.1.tar.gz.part-* | tar -xz&lt;/pre&gt;By the way, WOW.  The installation process for this software is not straightforward.  See the install file for the instructions on installation - read for background, then copy-paste below as usual. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;gedit ./INSTALL&lt;/pre&gt;Step 2 - swap out the SRILM variable for one delimiting the root directory of the package. Source.&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ‘7s#.*#SRILM = ~/tools/srilm#’ ./Makefile&lt;/pre&gt;For now, assuming that the variables are all good.  I don’t know if I want maximum entropy models, though it sounds useful…I’ll see what happens if I don’t prep them. Installing John Ousterhout’s TCL toolkit - we’re past the required v7.3, and up to 8.6: hope this still works.  I’m compiling from source rather than using the available binaries ‘cause they come with some kind of non-commercial/education license, which I don’t like being tied down by. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/tcl-tk.gitcd ./tcl-tkgunzip &lt; tcl8.6.6-src.tar.gz | tar xvf -gunzip &lt; tk8.6.6-src.tar.gz | tar xvf -&lt;/pre&gt;Install TCL:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd tcl8.6.6/unix# chmod +x configureconfigure –enable-threadsmake -j 3make test sudo make -j 3 install&lt;/pre&gt;Let’s try running the rest without the TK stuff…even though John says it’s needed.  Heh.  Leeeroooy Jenkins!&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ../../../srilmmake World&lt;/pre&gt;…aaaaaaaand, Fail. This is going nowhere fast.  We’re in dependency hell.  Let’s try the perl script CMU uses (it’s the backend to the online service they officially reference). &lt;h3&gt;The Perl Script&lt;/h3&gt;Thankfully, Mint comes with perl installed.  So, the question is how to use the script. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsmkdir ./CMU_LMtool &amp;&amp; cd ./CMU_LMtoolwget http://www.speech.cs.cmu.edu/tools/download/quick_lm.pl&lt;/pre&gt;The only thing left here is to figure out how to use the script…having never used perl, this could be interesting.  Dug this nugget out of the script:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;usage: quick_lm -s &lt;sentence_file&gt; [-w &lt;word_file&gt;] [-d discount]&lt;/pre&gt;So, the idea with the LMtool is to process sentences that the decoder should recognize - it doesn’t need to be an exhaustive list, however, because the decoder will allow fragments to recombine in the detection phase.  As a corpus example (from the CMU website), here’s the following:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;THIS IS AN EXAMPLE SENTENCEEACH LINE IS SOMETHING THAT YOU’D WANT YOUR SYSTEM TO RECOGNIZEACRONYMS PRONOUNCED AS LETTERS ARE BEST ENTERED AS A T_L_ANUMBERS AND ABBREVIATIONS OUGHT TO BE SPELLED OUT FOR EXAMPLETWO HUNDRED SIXTY THREE ET CETERAYOU CAN UPLOAD A FEW THOUSAND SENTENCESBUT THERE IS A LIMIT&lt;/pre&gt;We’ll use this sentence collection to test the perl script: &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Well, it did exactly nothing.  No terminal output, no new files created in the directory, and no errors.  Time to search the script for other possible output locations.  How weird can it be?…Ok, solved the problem.  Thank goodness for auto highlighting in Gedit.  The authors used some kind of weird system for comments that I’m guessing was retired since this script was written.  It seems to have been throwing the compiler for a loop:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;=POD/[some text wrapped by those comment markers]/[more text, only wrapped by the ‘=’ things]=END&lt;/pre&gt;So, I re-commented all the introductory stuff, and put the fixed version in the github repo.&lt;h4&gt;Summary of the Perl script&lt;/h4&gt;So, here’s how it works: download the fixed script, give it a sentence list, and run the command.  Simple.  And, looking at the output, the function it performs is pretty simple too.  Makes a list of all the 1, 2 and 3 - word groupings in the list. Here’s what to do:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ~/tools/CMU_LMtool &amp;&amp; cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/quick_lm.plperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Still not sure what that does for me, but I have my LM!Notes: I think the word list option in the command refers to the possibility of a limited vocabulary…not sure how that relates to words outside that list used in the sentence list.  The discount in the command, however, is fixed at 0.5.  Apparently Greg and Ben did some experiments to discover that’s definitely the optimal setting. Second Note:  based on readings from the CMU website, this LM isn’t good for much more than command-and-control - it can successfully detect short phrases accurately, but not long, drawn-out sentences.  So it’ll be good for most of what I want, but anything complex will need to be done with the CMULMTK package. Hold on - the [-w &lt;word_file&gt;] option for a dictionary might be a request for output - not an extra input.  And given that I do need an explicit dictionary for transcription, that’s probably what it does.  That would be wonderful.  I can even use that sentence list for voice training - which would be a fabulous way to ensure accuracy. Unfortunately, that’s not the case.  Oh, well.&lt;h3&gt;The official CMU Statistical Language Model toolkit&lt;/h3&gt;Ok, maybe this’ll do it for me.  Here’s the link to the source.  The Perl script doesn’t make all the different files I need - especially the pronunciation dictionary. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ./tools/CMUSLMcd ./tools/CMUSLMwget http://www.speech.cs.cmu.edu/SLM/CMU-Cam_Toolkit_v2.tar.gzgunzip &lt; CMU-Cam_Toolkit_v2.tar.gz | tar xvcd ./CMU-Cam_Toolkit_v2&lt;/pre&gt;Wow, this is old.  You have to uncomment something if your computer isn’t running HP-UX, IRIX, SunOS, or Solaris.  I’m pretty sure anything build in this decade needs uncomment, but if you’re unsure the README mentions a script you can run to check for yourself:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;bash endian.sh&lt;/pre&gt;Ok, uncomment:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ’37s/#//’ ./src/Makefilecd srcmake install&lt;/pre&gt;Hard to tell if this was successful.  I get the impression watching this compile that it was written in the 80s, and updated for compatibility with something advertising a max capacity of 512 Mb of random access memory. Time to dive into the html documentation, and figure out usage.  The goal is to create the LM and DIC files - and a nice perk would be the other stuff produced by the online LM generator.Turns out, there doesn’t seem to be any kind of pronunciation dictionary produced by this tool.  So it’s no good. &lt;h3&gt;The Logios Package&lt;/h3&gt;This seems to be the tool CMU claims was actually used in their website - and, indeed, some of their tools within the package are designed for use in a webform.  So I might be on the right track.  The only problem is, the input is not a list of sentences: it’s a grammar file built by the Phoenix tool. No idea what that is or how it works. CMU, get your act together!  The website is nice, but I’ve got no recourse if it goes down.  I want an independent system!Here goes.  Goal: LM and DIC files.  Starting point: list of sentences.Download the package.  Even this isn’t user-friendly - the folder structure is in html.  I used wget recursively to download the webpages.  See here for source on the command.&lt;h3&gt;CMUDict&lt;/h3&gt;&lt;div&gt;Actually, it seems like I could just use the dictionary directly.  The whole problem is one of how to get the entries from this file into a subset file that holds just what I want - so I’ll just write a small script to do just that.  What a pain.  &lt;/div&gt;&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;wget http://svn.code.sf.net/p/cmusphinx/code/trunk/cmudict/sphinxdict/cmudict_SPHINX_40&lt;/pre&gt;I’ll post the script soon - it’s being added to a larger package that should make the process of getting a personal language model pretty painless.  That’d be nice." />
<meta property="og:description" content="Update: I finished my script for creating custom language models.  See here: https://github.com/umhau/vmc.There’s a summary at the end with what I figured out.  Most of this is me thinking on paper.The statistical language model is used for helping CMU Sphinx know what words exist, and what the order the words exist in (the grammar and syntax structure).  The intro website to all this is here.I’m trying to decide between the SRILM and the MITLM packages [subsequent edit: also the logios package and the quicklm pearl script - these are referenced in hard-to-find places on the CMU website; see here and here, respectively] [another subsequent edit: looks like I found a link to the official CMU Statistical Language Model toolkit - it was buried in the QuickLM script].  S- is easier to use, apparently, and the CMU site provides example commands.  M-, however, seems more likely to stick around and be accessible on github for the long-term.  Plus, I forked it. [sorry, blogger’s formatting broke and I had to convert everything to plaintext and start over…lost the links.]Only downside is, the main contributor to MITLM stopped work on it about 6 mos ago, and started dealing with Kaldi instead.  Guess he figured the newer tech was more worth his time.  Still, dinosaurs have their place; just watch Space Cowboys to get the picture. &lt;h3&gt;MITLM&lt;/h3&gt;Just to be sure that the software doesn’t go anywhere, code is downloaded from my repository.Update: Thanks to Qi Wang’s comment below there’s an extra dependency to install:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sudo apt-get install autoconf-archive&lt;/pre&gt;Installation of MITLM:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/mitlm.gitcd ./mitlm./autogen.sh./configuremakemake install&lt;/pre&gt;So, turns out that there&#39;s some weird problems with the installation. &nbsp;Something changed, or something isn&#39;t being installed properly. &nbsp;The compilation seems to fail with these errors:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;./configure: line 19641: AX_CXX_HEADER_TR1_UNORDERED_MAP: command not found./configure: line 19642: syntax error near unexpected token `noext,&#39;./configure: line 19642: `AX_CXX_COMPILE_STDCXX_11(noext, optional)&#39;&lt;/pre&gt;g++ wasn&#39;t installed, but even after that was added it still wouldn&#39;t work.Update: Unfortunately, I’ve lost track of other dependencies involved - at some point, I’ll make a list of all the stuff I’ve installed while working on this project.  Had to install libtool (or similar?) to get here.  Mental note:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;libtoolize: error: Failed to create ‘build-aux’&lt;/pre&gt;But, that’s because I’m trying to do this on a different Mint installation from my usual - on my default workstation, that dependency is installed (no idea what it is, except that it’s probably listed somewhere on this blog). &lt;div&gt;&lt;/div&gt;After installing the extra dependency, the installation works! So this is a viable avenue thus far to get the LM working.  I’ve already made it past where I need the MITLM, though, so I’m going to let it be for now.  Might have to come back for it.&lt;h3&gt;SRILM&lt;/h3&gt;Ok, let’s see what SRILM has to offer us. It’s more inconvenient to install; ya have to go through a license agreement to download it, so I can’t just stick a bash command here.…unless I put the code on my github.  In which case, it’s easy to get a copy of.  Too bad there’s too many files to put up an extracted version, and too bad the compressed version is more than 25mb.  Time to split up the tar.gz file again; for my own records, here’s how I split it.  All I need for getting and using it is the reconstruction bit. The splitting part, given the archive file:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;split -b 24m -d srilm-1.7.1.tar.gz srilm-1.7.1.tar.gz.part-&lt;/pre&gt;Alright. Once the file is on github, it’s just more copy-pasting. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/srilm.gitcd ./srilmcat srilm-1.7.1.tar.gz.part-* | tar -xz&lt;/pre&gt;By the way, WOW.  The installation process for this software is not straightforward.  See the install file for the instructions on installation - read for background, then copy-paste below as usual. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;gedit ./INSTALL&lt;/pre&gt;Step 2 - swap out the SRILM variable for one delimiting the root directory of the package. Source.&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ‘7s#.*#SRILM = ~/tools/srilm#’ ./Makefile&lt;/pre&gt;For now, assuming that the variables are all good.  I don’t know if I want maximum entropy models, though it sounds useful…I’ll see what happens if I don’t prep them. Installing John Ousterhout’s TCL toolkit - we’re past the required v7.3, and up to 8.6: hope this still works.  I’m compiling from source rather than using the available binaries ‘cause they come with some kind of non-commercial/education license, which I don’t like being tied down by. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/tcl-tk.gitcd ./tcl-tkgunzip &lt; tcl8.6.6-src.tar.gz | tar xvf -gunzip &lt; tk8.6.6-src.tar.gz | tar xvf -&lt;/pre&gt;Install TCL:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd tcl8.6.6/unix# chmod +x configureconfigure –enable-threadsmake -j 3make test sudo make -j 3 install&lt;/pre&gt;Let’s try running the rest without the TK stuff…even though John says it’s needed.  Heh.  Leeeroooy Jenkins!&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ../../../srilmmake World&lt;/pre&gt;…aaaaaaaand, Fail. This is going nowhere fast.  We’re in dependency hell.  Let’s try the perl script CMU uses (it’s the backend to the online service they officially reference). &lt;h3&gt;The Perl Script&lt;/h3&gt;Thankfully, Mint comes with perl installed.  So, the question is how to use the script. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsmkdir ./CMU_LMtool &amp;&amp; cd ./CMU_LMtoolwget http://www.speech.cs.cmu.edu/tools/download/quick_lm.pl&lt;/pre&gt;The only thing left here is to figure out how to use the script…having never used perl, this could be interesting.  Dug this nugget out of the script:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;usage: quick_lm -s &lt;sentence_file&gt; [-w &lt;word_file&gt;] [-d discount]&lt;/pre&gt;So, the idea with the LMtool is to process sentences that the decoder should recognize - it doesn’t need to be an exhaustive list, however, because the decoder will allow fragments to recombine in the detection phase.  As a corpus example (from the CMU website), here’s the following:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;THIS IS AN EXAMPLE SENTENCEEACH LINE IS SOMETHING THAT YOU’D WANT YOUR SYSTEM TO RECOGNIZEACRONYMS PRONOUNCED AS LETTERS ARE BEST ENTERED AS A T_L_ANUMBERS AND ABBREVIATIONS OUGHT TO BE SPELLED OUT FOR EXAMPLETWO HUNDRED SIXTY THREE ET CETERAYOU CAN UPLOAD A FEW THOUSAND SENTENCESBUT THERE IS A LIMIT&lt;/pre&gt;We’ll use this sentence collection to test the perl script: &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Well, it did exactly nothing.  No terminal output, no new files created in the directory, and no errors.  Time to search the script for other possible output locations.  How weird can it be?…Ok, solved the problem.  Thank goodness for auto highlighting in Gedit.  The authors used some kind of weird system for comments that I’m guessing was retired since this script was written.  It seems to have been throwing the compiler for a loop:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;=POD/[some text wrapped by those comment markers]/[more text, only wrapped by the ‘=’ things]=END&lt;/pre&gt;So, I re-commented all the introductory stuff, and put the fixed version in the github repo.&lt;h4&gt;Summary of the Perl script&lt;/h4&gt;So, here’s how it works: download the fixed script, give it a sentence list, and run the command.  Simple.  And, looking at the output, the function it performs is pretty simple too.  Makes a list of all the 1, 2 and 3 - word groupings in the list. Here’s what to do:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ~/tools/CMU_LMtool &amp;&amp; cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/quick_lm.plperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Still not sure what that does for me, but I have my LM!Notes: I think the word list option in the command refers to the possibility of a limited vocabulary…not sure how that relates to words outside that list used in the sentence list.  The discount in the command, however, is fixed at 0.5.  Apparently Greg and Ben did some experiments to discover that’s definitely the optimal setting. Second Note:  based on readings from the CMU website, this LM isn’t good for much more than command-and-control - it can successfully detect short phrases accurately, but not long, drawn-out sentences.  So it’ll be good for most of what I want, but anything complex will need to be done with the CMULMTK package. Hold on - the [-w &lt;word_file&gt;] option for a dictionary might be a request for output - not an extra input.  And given that I do need an explicit dictionary for transcription, that’s probably what it does.  That would be wonderful.  I can even use that sentence list for voice training - which would be a fabulous way to ensure accuracy. Unfortunately, that’s not the case.  Oh, well.&lt;h3&gt;The official CMU Statistical Language Model toolkit&lt;/h3&gt;Ok, maybe this’ll do it for me.  Here’s the link to the source.  The Perl script doesn’t make all the different files I need - especially the pronunciation dictionary. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ./tools/CMUSLMcd ./tools/CMUSLMwget http://www.speech.cs.cmu.edu/SLM/CMU-Cam_Toolkit_v2.tar.gzgunzip &lt; CMU-Cam_Toolkit_v2.tar.gz | tar xvcd ./CMU-Cam_Toolkit_v2&lt;/pre&gt;Wow, this is old.  You have to uncomment something if your computer isn’t running HP-UX, IRIX, SunOS, or Solaris.  I’m pretty sure anything build in this decade needs uncomment, but if you’re unsure the README mentions a script you can run to check for yourself:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;bash endian.sh&lt;/pre&gt;Ok, uncomment:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ’37s/#//’ ./src/Makefilecd srcmake install&lt;/pre&gt;Hard to tell if this was successful.  I get the impression watching this compile that it was written in the 80s, and updated for compatibility with something advertising a max capacity of 512 Mb of random access memory. Time to dive into the html documentation, and figure out usage.  The goal is to create the LM and DIC files - and a nice perk would be the other stuff produced by the online LM generator.Turns out, there doesn’t seem to be any kind of pronunciation dictionary produced by this tool.  So it’s no good. &lt;h3&gt;The Logios Package&lt;/h3&gt;This seems to be the tool CMU claims was actually used in their website - and, indeed, some of their tools within the package are designed for use in a webform.  So I might be on the right track.  The only problem is, the input is not a list of sentences: it’s a grammar file built by the Phoenix tool. No idea what that is or how it works. CMU, get your act together!  The website is nice, but I’ve got no recourse if it goes down.  I want an independent system!Here goes.  Goal: LM and DIC files.  Starting point: list of sentences.Download the package.  Even this isn’t user-friendly - the folder structure is in html.  I used wget recursively to download the webpages.  See here for source on the command.&lt;h3&gt;CMUDict&lt;/h3&gt;&lt;div&gt;Actually, it seems like I could just use the dictionary directly.  The whole problem is one of how to get the entries from this file into a subset file that holds just what I want - so I’ll just write a small script to do just that.  What a pain.  &lt;/div&gt;&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;wget http://svn.code.sf.net/p/cmusphinx/code/trunk/cmudict/sphinxdict/cmudict_SPHINX_40&lt;/pre&gt;I’ll post the script soon - it’s being added to a larger package that should make the process of getting a personal language model pretty painless.  That’d be nice." />
<link rel="canonical" href="http://localhost:4000/2016/10/11/building-statistical-language-model_11/" />
<meta property="og:url" content="http://localhost:4000/2016/10/11/building-statistical-language-model_11/" />
<meta property="og:site_name" content="nixing around" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-10-11T23:10:00-04:00" />
<script type="application/ld+json">
{"name":null,"description":"Update: I finished my script for creating custom language models.  See here: https://github.com/umhau/vmc.There’s a summary at the end with what I figured out.  Most of this is me thinking on paper.The statistical language model is used for helping CMU Sphinx know what words exist, and what the order the words exist in (the grammar and syntax structure).  The intro website to all this is here.I’m trying to decide between the SRILM and the MITLM packages [subsequent edit: also the logios package and the quicklm pearl script - these are referenced in hard-to-find places on the CMU website; see here and here, respectively] [another subsequent edit: looks like I found a link to the official CMU Statistical Language Model toolkit - it was buried in the QuickLM script].  S- is easier to use, apparently, and the CMU site provides example commands.  M-, however, seems more likely to stick around and be accessible on github for the long-term.  Plus, I forked it. [sorry, blogger’s formatting broke and I had to convert everything to plaintext and start over…lost the links.]Only downside is, the main contributor to MITLM stopped work on it about 6 mos ago, and started dealing with Kaldi instead.  Guess he figured the newer tech was more worth his time.  Still, dinosaurs have their place; just watch Space Cowboys to get the picture. &lt;h3&gt;MITLM&lt;/h3&gt;Just to be sure that the software doesn’t go anywhere, code is downloaded from my repository.Update: Thanks to Qi Wang’s comment below there’s an extra dependency to install:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sudo apt-get install autoconf-archive&lt;/pre&gt;Installation of MITLM:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/mitlm.gitcd ./mitlm./autogen.sh./configuremakemake install&lt;/pre&gt;So, turns out that there&#39;s some weird problems with the installation. &nbsp;Something changed, or something isn&#39;t being installed properly. &nbsp;The compilation seems to fail with these errors:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;./configure: line 19641: AX_CXX_HEADER_TR1_UNORDERED_MAP: command not found./configure: line 19642: syntax error near unexpected token `noext,&#39;./configure: line 19642: `AX_CXX_COMPILE_STDCXX_11(noext, optional)&#39;&lt;/pre&gt;g++ wasn&#39;t installed, but even after that was added it still wouldn&#39;t work.Update: Unfortunately, I’ve lost track of other dependencies involved - at some point, I’ll make a list of all the stuff I’ve installed while working on this project.  Had to install libtool (or similar?) to get here.  Mental note:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;libtoolize: error: Failed to create ‘build-aux’&lt;/pre&gt;But, that’s because I’m trying to do this on a different Mint installation from my usual - on my default workstation, that dependency is installed (no idea what it is, except that it’s probably listed somewhere on this blog). &lt;div&gt;&lt;/div&gt;After installing the extra dependency, the installation works! So this is a viable avenue thus far to get the LM working.  I’ve already made it past where I need the MITLM, though, so I’m going to let it be for now.  Might have to come back for it.&lt;h3&gt;SRILM&lt;/h3&gt;Ok, let’s see what SRILM has to offer us. It’s more inconvenient to install; ya have to go through a license agreement to download it, so I can’t just stick a bash command here.…unless I put the code on my github.  In which case, it’s easy to get a copy of.  Too bad there’s too many files to put up an extracted version, and too bad the compressed version is more than 25mb.  Time to split up the tar.gz file again; for my own records, here’s how I split it.  All I need for getting and using it is the reconstruction bit. The splitting part, given the archive file:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;split -b 24m -d srilm-1.7.1.tar.gz srilm-1.7.1.tar.gz.part-&lt;/pre&gt;Alright. Once the file is on github, it’s just more copy-pasting. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/srilm.gitcd ./srilmcat srilm-1.7.1.tar.gz.part-* | tar -xz&lt;/pre&gt;By the way, WOW.  The installation process for this software is not straightforward.  See the install file for the instructions on installation - read for background, then copy-paste below as usual. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;gedit ./INSTALL&lt;/pre&gt;Step 2 - swap out the SRILM variable for one delimiting the root directory of the package. Source.&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ‘7s#.*#SRILM = ~/tools/srilm#’ ./Makefile&lt;/pre&gt;For now, assuming that the variables are all good.  I don’t know if I want maximum entropy models, though it sounds useful…I’ll see what happens if I don’t prep them. Installing John Ousterhout’s TCL toolkit - we’re past the required v7.3, and up to 8.6: hope this still works.  I’m compiling from source rather than using the available binaries ‘cause they come with some kind of non-commercial/education license, which I don’t like being tied down by. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsgit clone https://github.com/umhau/tcl-tk.gitcd ./tcl-tkgunzip &lt; tcl8.6.6-src.tar.gz | tar xvf -gunzip &lt; tk8.6.6-src.tar.gz | tar xvf -&lt;/pre&gt;Install TCL:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd tcl8.6.6/unix# chmod +x configureconfigure –enable-threadsmake -j 3make test sudo make -j 3 install&lt;/pre&gt;Let’s try running the rest without the TK stuff…even though John says it’s needed.  Heh.  Leeeroooy Jenkins!&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ../../../srilmmake World&lt;/pre&gt;…aaaaaaaand, Fail. This is going nowhere fast.  We’re in dependency hell.  Let’s try the perl script CMU uses (it’s the backend to the online service they officially reference). &lt;h3&gt;The Perl Script&lt;/h3&gt;Thankfully, Mint comes with perl installed.  So, the question is how to use the script. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/toolsmkdir ./CMU_LMtool &amp;&amp; cd ./CMU_LMtoolwget http://www.speech.cs.cmu.edu/tools/download/quick_lm.pl&lt;/pre&gt;The only thing left here is to figure out how to use the script…having never used perl, this could be interesting.  Dug this nugget out of the script:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;usage: quick_lm -s &lt;sentence_file&gt; [-w &lt;word_file&gt;] [-d discount]&lt;/pre&gt;So, the idea with the LMtool is to process sentences that the decoder should recognize - it doesn’t need to be an exhaustive list, however, because the decoder will allow fragments to recombine in the detection phase.  As a corpus example (from the CMU website), here’s the following:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;THIS IS AN EXAMPLE SENTENCEEACH LINE IS SOMETHING THAT YOU’D WANT YOUR SYSTEM TO RECOGNIZEACRONYMS PRONOUNCED AS LETTERS ARE BEST ENTERED AS A T_L_ANUMBERS AND ABBREVIATIONS OUGHT TO BE SPELLED OUT FOR EXAMPLETWO HUNDRED SIXTY THREE ET CETERAYOU CAN UPLOAD A FEW THOUSAND SENTENCESBUT THERE IS A LIMIT&lt;/pre&gt;We’ll use this sentence collection to test the perl script: &lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Well, it did exactly nothing.  No terminal output, no new files created in the directory, and no errors.  Time to search the script for other possible output locations.  How weird can it be?…Ok, solved the problem.  Thank goodness for auto highlighting in Gedit.  The authors used some kind of weird system for comments that I’m guessing was retired since this script was written.  It seems to have been throwing the compiler for a loop:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;=POD/[some text wrapped by those comment markers]/[more text, only wrapped by the ‘=’ things]=END&lt;/pre&gt;So, I re-commented all the introductory stuff, and put the fixed version in the github repo.&lt;h4&gt;Summary of the Perl script&lt;/h4&gt;So, here’s how it works: download the fixed script, give it a sentence list, and run the command.  Simple.  And, looking at the output, the function it performs is pretty simple too.  Makes a list of all the 1, 2 and 3 - word groupings in the list. Here’s what to do:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ~/tools/CMU_LMtool &amp;&amp; cd ~/tools/CMU_LMtoolwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txtwget https://raw.githubusercontent.com/umhau/misc-LMtools/master/quick_lm.plperl quick_lm.pl -s ex-corpus.txt&lt;/pre&gt;Still not sure what that does for me, but I have my LM!Notes: I think the word list option in the command refers to the possibility of a limited vocabulary…not sure how that relates to words outside that list used in the sentence list.  The discount in the command, however, is fixed at 0.5.  Apparently Greg and Ben did some experiments to discover that’s definitely the optimal setting. Second Note:  based on readings from the CMU website, this LM isn’t good for much more than command-and-control - it can successfully detect short phrases accurately, but not long, drawn-out sentences.  So it’ll be good for most of what I want, but anything complex will need to be done with the CMULMTK package. Hold on - the [-w &lt;word_file&gt;] option for a dictionary might be a request for output - not an extra input.  And given that I do need an explicit dictionary for transcription, that’s probably what it does.  That would be wonderful.  I can even use that sentence list for voice training - which would be a fabulous way to ensure accuracy. Unfortunately, that’s not the case.  Oh, well.&lt;h3&gt;The official CMU Statistical Language Model toolkit&lt;/h3&gt;Ok, maybe this’ll do it for me.  Here’s the link to the source.  The Perl script doesn’t make all the different files I need - especially the pronunciation dictionary. &lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;mkdir ./tools/CMUSLMcd ./tools/CMUSLMwget http://www.speech.cs.cmu.edu/SLM/CMU-Cam_Toolkit_v2.tar.gzgunzip &lt; CMU-Cam_Toolkit_v2.tar.gz | tar xvcd ./CMU-Cam_Toolkit_v2&lt;/pre&gt;Wow, this is old.  You have to uncomment something if your computer isn’t running HP-UX, IRIX, SunOS, or Solaris.  I’m pretty sure anything build in this decade needs uncomment, but if you’re unsure the README mentions a script you can run to check for yourself:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;bash endian.sh&lt;/pre&gt;Ok, uncomment:&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;sed -i ’37s/#//’ ./src/Makefilecd srcmake install&lt;/pre&gt;Hard to tell if this was successful.  I get the impression watching this compile that it was written in the 80s, and updated for compatibility with something advertising a max capacity of 512 Mb of random access memory. Time to dive into the html documentation, and figure out usage.  The goal is to create the LM and DIC files - and a nice perk would be the other stuff produced by the online LM generator.Turns out, there doesn’t seem to be any kind of pronunciation dictionary produced by this tool.  So it’s no good. &lt;h3&gt;The Logios Package&lt;/h3&gt;This seems to be the tool CMU claims was actually used in their website - and, indeed, some of their tools within the package are designed for use in a webform.  So I might be on the right track.  The only problem is, the input is not a list of sentences: it’s a grammar file built by the Phoenix tool. No idea what that is or how it works. CMU, get your act together!  The website is nice, but I’ve got no recourse if it goes down.  I want an independent system!Here goes.  Goal: LM and DIC files.  Starting point: list of sentences.Download the package.  Even this isn’t user-friendly - the folder structure is in html.  I used wget recursively to download the webpages.  See here for source on the command.&lt;h3&gt;CMUDict&lt;/h3&gt;&lt;div&gt;Actually, it seems like I could just use the dictionary directly.  The whole problem is one of how to get the entries from this file into a subset file that holds just what I want - so I’ll just write a small script to do just that.  What a pain.  &lt;/div&gt;&lt;pre style=&quot;background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;&quot;&gt;wget http://svn.code.sf.net/p/cmusphinx/code/trunk/cmudict/sphinxdict/cmudict_SPHINX_40&lt;/pre&gt;I’ll post the script soon - it’s being added to a larger package that should make the process of getting a personal language model pretty painless.  That’d be nice.","author":{"@type":"Person","name":"umhau"},"@type":"BlogPosting","url":"http://localhost:4000/2016/10/11/building-statistical-language-model_11/","publisher":null,"image":null,"headline":"Building a Statistical Language Model","dateModified":"2016-10-11T23:10:00-04:00","datePublished":"2016-10-11T23:10:00-04:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/10/11/building-statistical-language-model_11/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" type="text/css" href="/assets/css/styles.css">
    <meta name="viewport" content="width=device-width">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/js/infinite-jekyll.js"></script>

  </head>
  <body>
    <box class="wrapper">
      <header>
        <a href="http://localhost:4000"> <h1>*nixing around</h1> </a>
        <p>A programmer's journal of complicated projects.</p>
        <p class="view"><a href="">github</a> | <a href="http://localhost:4000/about">about</a> | <a href="http://localhost:4000/explore">explore</a></p>

        <p>testing</p>

      </header>
      <section>

      <div class="post">

    <header class="post-header">
        
    <h1 class="post-title">Building a Statistical Language Model</h1>
    <p 
        class="post-meta">Oct 11, 2016 • <a  href="/2016/10/11/building-statistical-language-model_11/">permalink</a>
        <i>  • Linux • speech to text • success • Mint 17.3 • perl • SRILM • MITLM • Language Model • package installation • CMU Sphinx</i> 
    </p>
    </header>

    <article class="post-content">
    <b>Update: </b>I finished my script for creating custom language models. &nbsp;See here:&nbsp;<a href="https://github.com/umhau/vmc">https://github.com/umhau/vmc</a>.<br /><br />There's a summary at the end with what I figured out. &nbsp;Most of this is me thinking on paper.<br /><br />The statistical language model is used for helping CMU Sphinx know what words exist, and what the order the words exist in (the grammar and syntax structure). &nbsp;The intro website to all this is here.<br /><br />I'm trying to decide between the SRILM and the MITLM packages [subsequent edit: also the logios package and the quicklm pearl script - these are referenced in hard-to-find places on the CMU website; see here and here, respectively] [another subsequent edit: looks like I found a link to the official CMU Statistical Language Model toolkit - it was buried in the QuickLM script]. &nbsp;S- is easier to use, apparently, and the CMU site provides example commands. &nbsp;M-, however, seems more likely to stick around and be accessible on github for the long-term. &nbsp;Plus, I forked it. <br /><br />[sorry, blogger's formatting broke and I had to convert everything to plaintext and start over...lost the links.]<br /><br />Only downside is, the main contributor to MITLM stopped work on it about 6 mos ago, and started dealing with Kaldi instead. &nbsp;Guess he figured the newer tech was more worth his time. &nbsp;Still, dinosaurs have their place; just watch Space Cowboys to get the picture. <br /><h3>MITLM</h3>Just to be sure that the software doesn't go anywhere, code is downloaded from my repository.<br /><br /><b>Update:</b>&nbsp;Thanks to Qi Wang's comment below there's an extra dependency to install:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">sudo apt-get install autoconf-archive</span></pre>Installation of MITLM:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ~/tools<br />git clone https://github.com/umhau/mitlm.git<br />cd ./mitlm<br />./autogen.sh<br />./configure<br />make<br />make install</span></pre><strike>So, turns out that there's some weird problems with the installation. &nbsp;Something changed, or something isn't being installed properly. &nbsp;The compilation seems to fail with these errors:</strike><br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;"><strike>./configure: line 19641: AX_CXX_HEADER_TR1_UNORDERED_MAP: command not found<br />./configure: line 19642: syntax error near unexpected token `noext,'<br />./configure: line 19642: `AX_CXX_COMPILE_STDCXX_11(noext, optional)'</strike></span></pre><strike>g++ wasn't installed, but even after that was added it still wouldn't work.</strike><br /><br /><b>Update:</b>&nbsp;Unfortunately, I've lost track of other dependencies involved - at some point, I'll make a list of all the stuff I've installed while working on this project. &nbsp;Had to install libtool (or similar?) to get here. &nbsp;Mental note:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">libtoolize:   error: Failed to create 'build-aux'</span></pre>But, that's because I'm trying to do this on a different Mint installation from my usual - on my default workstation, that dependency is installed (no idea what it is, except that it's probably listed somewhere on this blog). <br /><div><br /></div><b>A</b>fter installing the extra dependency, the installation works! So this is a viable avenue thus far to get the LM working. &nbsp;I've already made it past where I need the MITLM, though, so I'm going to let it be for now. &nbsp;Might have to come back for it.<br /><h3>SRILM</h3>Ok, let's see what SRILM has to offer us. It's more inconvenient to install; ya have to go through a license agreement to download it, so I can't just stick a bash command here.<br /><br />...unless I put the code on my github. &nbsp;In which case, it's easy to get a copy of. &nbsp;Too bad there's too many files to put up an extracted version, and too bad the compressed version is more than 25mb. &nbsp;Time to split up the tar.gz file again; for my own records, here's how I split it. &nbsp;All I need for getting and using it is the reconstruction bit. <br /><br />The splitting part, given the archive file:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">split -b 24m -d srilm-1.7.1.tar.gz srilm-1.7.1.tar.gz.part-</span></pre>Alright. Once the file is on github, it's just more copy-pasting. <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ~/tools<br />git clone https://github.com/umhau/srilm.git<br />cd ./srilm<br />cat srilm-1.7.1.tar.gz.part-* | tar -xz</span></pre>By the way, WOW. &nbsp;The installation process for this software is not straightforward. &nbsp;See the install file for the instructions on installation - read for background, then copy-paste below as usual. <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">gedit ./INSTALL</span></pre>Step 2 - swap out the SRILM variable for one delimiting the root directory of the package. <a href="http://sed%20-i%20%2737s/#//' ./src/Makefile" target="_blank">Source</a>.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sed -i '7s#.*#SRILM = ~/tools/srilm#' ./Makefile</span></span></pre>For now, assuming that the variables are all good. &nbsp;I don't know if I want maximum entropy models, though it sounds useful...I'll see what happens if I don't prep them. <br /><br />Installing John Ousterhout's TCL toolkit - we're past the required v7.3, and up to 8.6: hope this still works. &nbsp;I'm compiling from source rather than using the available binaries 'cause they come with some kind of non-commercial/education license, which I don't like being tied down by. <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ~/tools<br />git clone https://github.com/umhau/tcl-tk.git<br />cd ./tcl-tk<br />gunzip &lt; tcl8.6.6-src.tar.gz | tar xvf -<br />gunzip &lt; tk8.6.6-src.tar.gz | tar xvf -</span></pre>Install TCL:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd tcl8.6.6/unix<br /># chmod +x configure<br />configure --enable-threads<br />make -j 3<br />make test <br />sudo make -j 3 install</span></pre>Let's try running the rest without the TK stuff...even though John says it's needed. &nbsp;Heh. &nbsp;Leeeroooy Jenkins!<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ../../../srilm<br />make World</span></pre>...aaaaaaaand, Fail. <br /><br />This is going nowhere fast. &nbsp;We're in dependency hell. &nbsp;Let's try the perl script CMU uses (it's the backend to the online service they officially reference). <br /><h3>The Perl Script</h3>Thankfully, Mint comes with perl installed. &nbsp;So, the question is how to use the script. <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ~/tools<br />mkdir ./CMU_LMtool &amp;&amp; cd ./CMU_LMtool<br />wget http://www.speech.cs.cmu.edu/tools/download/quick_lm.pl</span></pre>The only thing left here is to figure out how to use the script...having never used perl, this could be interesting. &nbsp;Dug this nugget out of the script:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">usage: quick_lm -s &lt;sentence_file&gt; [-w &lt;word_file&gt;] [-d discount]</span></pre>So, the idea with the LMtool is to process sentences that the decoder should recognize - it doesn't need to be an exhaustive list, however, because the decoder will allow fragments to recombine in the detection phase. &nbsp;As a corpus example (from the CMU website), here's the following:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">THIS IS AN EXAMPLE SENTENCE<br />EACH LINE IS SOMETHING THAT YOU'D WANT YOUR SYSTEM TO RECOGNIZE<br />ACRONYMS PRONOUNCED AS LETTERS ARE BEST ENTERED AS A T_L_A<br />NUMBERS AND ABBREVIATIONS OUGHT TO BE SPELLED OUT FOR EXAMPLE<br />TWO HUNDRED SIXTY THREE ET CETERA<br />YOU CAN UPLOAD A FEW THOUSAND SENTENCES<br />BUT THERE IS A LIMIT</span></pre>We'll use this sentence collection to test the perl script: <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">cd ~/tools/CMU_LMtool<br />wget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txt<br />perl </span>quick_lm.pl -s ex-corpus.txt</pre>Well, it did exactly nothing. &nbsp;No terminal output, no new files created in the directory, and no errors. &nbsp;Time to search the script for other possible output locations. &nbsp;How weird can it be?<br /><br />...<br /><br />Ok, solved the problem. &nbsp;Thank goodness for auto highlighting in Gedit. &nbsp;The authors used some kind of weird system for comments that I'm guessing was retired since this script was written. &nbsp;It seems to have been throwing the compiler for a loop:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">=POD<br />/*<br />[some text wrapped by those comment markers]<br />*/<br />[more text, only wrapped by the '=' things]<br />=END</span></pre>So, I re-commented all the introductory stuff, and put the fixed version in the github repo.<br /><h4>Summary of the Perl script</h4>So, here's how it works: download the fixed script, give it a sentence list, and run the command. &nbsp;Simple. &nbsp;And, looking at the output, the function it performs is pretty simple too. &nbsp;Makes a list of all the 1, 2 and 3 - word groupings in the list. <br /><br />Here's what to do:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="line-height: 19.6px;">mkdir ~/tools/CMU_LMtool &amp;&amp; cd ~/tools/CMU_LMtool<br />wget https://raw.githubusercontent.com/umhau/misc-LMtools/master/ex-corpus.txt<br />wget https://raw.githubusercontent.com/umhau/misc-LMtools/master/quick_lm.pl<br />perl quick_lm.pl -s ex-corpus.txt</span></pre>Still not sure what that does for me, but I have my LM!<br /><br />Notes: I think the word list option in the command refers to the possibility of a limited vocabulary...not sure how that relates to words outside that list used in the sentence list. &nbsp;The discount in the command, however, is fixed at 0.5. &nbsp;Apparently Greg and Ben did some experiments to discover that's definitely the optimal setting. <br /><br />Second Note: &nbsp;based on readings from the CMU website, this LM isn't good for much more than command-and-control - it can successfully detect short phrases accurately, but not long, drawn-out sentences. &nbsp;So it'll be good for most of what I want, but anything complex will need to be done with the <a href="http://cmusphinx.sourceforge.net/wiki/tutoriallm#arpa_model_training_with_cmuclmtk" target="_blank">CMULMTK package</a>. <br /><br />Hold on - the&nbsp;<span style="background-color: #eff0f1; color: #333333; font-size: 14px; text-align: justify;">[-w &lt;word_file&gt;]</span>&nbsp;option for a dictionary might be a request for <i>output</i>&nbsp;- not an extra input. &nbsp;And given that I do need an explicit dictionary for transcription, that's probably what it does. &nbsp;That would be wonderful. &nbsp;I can even use that sentence list for voice training - which would be a fabulous way to ensure accuracy. <br /><br />Unfortunately, that's not the case. &nbsp;Oh, well.<br /><h3>The official CMU Statistical Language Model toolkit</h3>Ok, maybe this'll do it for me. &nbsp;<a href="http://www.speech.cs.cmu.edu/SLM_info.html" target="_blank">Here's the link</a> to the source. &nbsp;The Perl script doesn't make all the different files I need - especially the pronunciation dictionary. <br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">mkdir ./tools/CMUSLM<br />cd ./tools/CMUSLM<br />wget http://www.speech.cs.cmu.edu/SLM/CMU-Cam_Toolkit_v2.tar.gz<br />gunzip &lt; CMU-Cam_Toolkit_v2.tar.gz | tar xv<br />cd ./CMU-Cam_Toolkit_v2</span></span></pre>Wow, this is old. &nbsp;You have to uncomment something if your computer <i>isn't</i> running HP-UX, IRIX, SunOS, or Solaris. &nbsp;I'm pretty sure anything build in this decade needs uncomment, but if you're unsure the README mentions a script you can run to check for yourself:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">bash endian.sh</span></span></pre>Ok, uncomment:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sed -i '37s/#//' ./src/Makefile<br />cd src<br />make install</span></span></pre>Hard to tell if this was successful. &nbsp;I get the impression watching this compile that it was written in the 80s, and updated for compatibility with something advertising a max capacity of 512 Mb of random access memory. <br /><br />Time to dive into the <a href="http://www.speech.cs.cmu.edu/SLM/toolkit_documentation.html" target="_blank">html documentation</a>, and figure out usage. &nbsp;The goal is to create the LM and DIC files - and a nice perk would be the other stuff produced by the online LM generator.<br /><br />Turns out, there doesn't seem to be any kind of pronunciation dictionary produced by this tool. &nbsp;So it's no good. <br /><h3>The Logios Package</h3>This seems to be the tool CMU claims was actually used in their website - and, indeed, some of their tools within the package are designed for use in a webform. &nbsp;So I might be on the right track. &nbsp;The only problem is, the input is not a list of sentences: it's a grammar file built by the Phoenix tool. No idea what that is or how it works. <br /><br />CMU, get your act together! &nbsp;The website is nice, but I've got no recourse if it goes down. &nbsp;I want an independent system!<br /><br />Here goes. &nbsp;Goal: LM and DIC files. &nbsp;Starting point: list of sentences.<br /><br />Download the package. &nbsp;Even this isn't user-friendly - the folder structure is in html. &nbsp;I used wget recursively to download the webpages. &nbsp;See <a href="http://stackoverflow.com/questions/13533217/how-to-download-all-links-to-zip-files-on-a-given-web-page-using-wget-curl#13574050" target="_blank">here</a> for source on the command.<br /><h3>CMUDict</h3><div>Actually, it seems like I could just use the dictionary directly. &nbsp;The whole problem is one of how to get the entries from this file into a subset file that holds just what I want - so I'll just write a small script to do just that. &nbsp;What a pain. &nbsp;</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; max-height: 600px; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">wget http://svn.code.sf.net/p/cmusphinx/code/trunk/cmudict/sphinxdict/cmudict_SPHINX_40</span></span></pre>I'll post the script soon - it's being added to a larger package that should make the process of getting a personal language model pretty painless. &nbsp;That'd be nice. <br /><br /><br /><br />
    </article>

    <p class="extra-space"></p>
    <hr>
    <p class="extra-space"></p>

</div>





      </section>
      <footer>
        <p><small>Hosted on GitHub &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a> and <a href="https://github.com/umhau">umhau</a></small></p>
      </footer>
    </box>
    <script src="/assets/js/scale.fix.js"></script>


  



  </body>
</html>
