<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">


    <link rel="stylesheet" type="text/css" href="/assets/css/styles.css">
    <meta name="viewport" content="width=device-width">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/js/infinite-jekyll.js"></script>

  </head>
  <body>
    <box class="wrapper">
      <header>
        <a href=""> <h1>*nixing around</h1> </a>
        <p>A programmer's journal of complicated projects.</p>
        <p class="view"><a href="">github</a> | <a href="/about">about</a> | <a href="/explore">explore</a></p>

        <p>testing</p>

      </header>
      <section>

      <div class="post">

    <header class="post-header">
        
    <h1 class="post-title">A Homemade Beowulf Cluster: Part 1, Hardware Assembly</h1>
    <p 
        class="post-meta">Jan 18, 2017 • <a  href="/2017/01/18/a-homebrew-beowulf-cluster-part-1/">permalink</a>
        <i>  • ubuntu • Linux Mint 18 • distributed computing • DATA • Ubuntu Server 16.04.1 LTS • beowulf cluster</i> 
    </p>
    </header>

    <article class="post-content">
    A beowulf cluster lets me tie miscellaneous computers together and use their cpus like one large processor...I think. &nbsp;Never done this before, still working on the details. <br /><br />I'm building this with random laptops: generally i5s, and I think one's a Core Duo - it's half decent thing from 2011. &nbsp;Might even throw in an RPi2 for good measure.<br /><br />Make sure you read through this before starting. &nbsp;You want to know what you're getting into. &nbsp;Watch out, though - this is a <i>long</i>&nbsp;post. <br /><h4>Notes</h4>Since we're working on multiple computers here, not everything is going to be cut-and-paste. &nbsp;I will make sure that it's as clear as possible, however. &nbsp;There won't be any hand-waving or assumptions of prior knowledge. <br /><br />I'm doing this with Linux Mint 18 on my primary laptop. <br /><h3>Primary Sources</h3><div>Setting up the cluster: <a href="https://help.ubuntu.com/community/MpichCluster" target="_blank">src 1</a>, &nbsp;<a href="http://www.linux.org/threads/building-a-linux-cluster.7858/" target="_blank">src 2</a>, <a href="https://www.reddit.com/r/linux/comments/57mug7/what_is_the_process_for_choosing_computers_for_a/#bottom-comments" target="_blank">src 3</a></div><h3>Hardware Ingredients</h3><div><ul><li>Since the benefit of this tool is sharing computations between computers, you need a way to route that information. &nbsp;Hence, an ethernet switch. &nbsp;Go for a gigabit, since you don't want the switch to be your bottleneck. &nbsp;I was cheap and got myself the 5-port version, and I'm already kicking myself. &nbsp;Go for the 8-port version at least. &nbsp;Here's <a href="http://amazon.com/gp/product/B000N99BBC" target="_blank">the 5-port version I got</a>, for consistency's sake.&nbsp;</li></ul><ul><li>A ton of ethernet cables. &nbsp;You can do with short ones, but you'll want to connect the switch to your router so you can access the computers from outside their own tiny network.</li></ul><ul><li>Leftover computers. &nbsp;You won't be using these for anything else, so make sure you don't need them.&nbsp;</li></ul></div><h3>Computer Preparation</h3><div>Install Ubuntu Server to each computer. I used&nbsp;16.04.1 LTS. &nbsp;For those with a penchant for funny names (or who need to deal with annoying, obtuse colloquialisms on the web), that's the&nbsp;Xenial Xerus edition.</div><div><br /></div><div>You'll need to keep track of computer names ("hostnames"), and install consistent users (so the username and password are the same on each machine). &nbsp;I like to increment the computer names with letters. &nbsp;For the purposes of this guide, we'll use:</div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">hostname:    grendel-a<br />username:    beowulf<br />password:    hrunting</pre><h4>Create installation USB flash drive</h4>Go <a href="https://www.ubuntu.com/download/server/thank-you?version=16.04.1&amp;architecture=amd64" target="_blank">here</a>&nbsp;to download the 16.04.1 LTS server ISO. &nbsp;That link initiates the download; <a href="https://www.ubuntu.com/download/server" target="_blank">here's</a> a bit of context. <br /><br />Burn the ISO to a USB flash drive. Note that you'll lose everything on the USB you use. &nbsp;Run the following command twice, once before plugging in your USB and then a few seconds after. &nbsp;The new entry when you run it the second time is your flash drive.<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">lsblk</pre>For example, this is the output when I run that command with a flash drive plugged in. &nbsp;Note on the right where it specifies the mount point (at /media/me/storage), and on the left where it shows me the name is sdb. <br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br />sda           8:0    0 167.7G  0 disk <br />├─sda1        8:1    0   487M  0 part /boot<br />└─sda5        8:5    0 167.2G  0 part <br />  ├─mint--vg-root<br />  │         252:0    0 159.3G  0 lvm  /<br />  └─mint--vg-swap_1<br />            252:1    0   7.9G  0 lvm  [SWAP]<br />sdb           8:16   1   1.9G  0 disk <br />└─sdb1        8:17   1   1.9M  0 part /media/me/storage</pre>If your USB is mounted, it has to be unmounted first - else weird things can happen in the next step. &nbsp;Trust me: once I didn't unmount a partition before copying it with dd, and my <a href="https://technet.microsoft.com/en-us/library/cc976786.aspx" target="_blank">MBR</a> was wiped out instead. &nbsp;In the example above, unmounting would work like this:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">umount "/media/me/storage"</pre>If we pretend your USB is the sdb device, this is the command you'd run (I'm assuming the ISO was saved to the default "~/Downloads" location). &nbsp;Swap out the 'sdb' part with what the lsblk command indicated. &nbsp;Also be aware that if you mess this up, you will probably destroy whatever computer you're running the command with. &nbsp;Just FYI.<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">sudo dd if=~/Downloads/ubuntu-16.04.1-server-amd64.iso of=/dev/sdb bs=4M status=progress</pre><h4>Install to each computer</h4>You're gonna have to follow this procedure with each computer in the cluster. &nbsp;There isn't a simple way around it, that I'm aware of.<br /><br />Plug in the flash drive, and reboot/turn on the computer. &nbsp;Make sure it's connected to the web. &nbsp;Press ESC, F1, F2, F11 or F12 to choose a startup device...if those don't work, Google:<br /><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">"how to choose startup device BIOS" &amp; [your computer type]</pre>e.g., "ThinkPad T420". <br /><br />When it boots up, there's a few settings to make sure of. &nbsp;Most of them should be straightforward: choosing a keyboard layout and a default language, for instance. &nbsp;Just in case of problems, here's a full walkthrough. <br /><div style="text-align: center;"></div><div style="text-align: center;"><a href="http://3.bp.blogspot.com/-72hsczpIXa8/WH_hyI0B_KI/AAAAAAAAUok/JScXoVeRk6EwV2FnExbXymED8swRGe4ZgCK4B/s1600/1.png" imageanchor="1"><img border="0" src="https://3.bp.blogspot.com/-72hsczpIXa8/WH_hyI0B_KI/AAAAAAAAUok/JScXoVeRk6EwV2FnExbXymED8swRGe4ZgCK4B/s1600/1.png" /></a></div>All you want is a simple installation.<br /><div style="text-align: center;"><a href="http://4.bp.blogspot.com/-_Je7fxVtNMk/WIACWgHfpcI/AAAAAAAAUq8/gFBZujXWu5A3yci9sAiB1oXFYwVvkS1bwCK4B/s1600/2.png" imageanchor="1"><img border="0" src="https://4.bp.blogspot.com/-_Je7fxVtNMk/WIACWgHfpcI/AAAAAAAAUq8/gFBZujXWu5A3yci9sAiB1oXFYwVvkS1bwCK4B/s1600/2.png" /></a></div>Don't bother with detecting the layout...if you're in the US or have an english keyboard, you can just stick with the defaults. &nbsp;Worst case, start over. &nbsp;There's a few more images after that one to do keyboard stuff, but you get the idea. <br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-5Ujwy5a9kx4/WIACbX8pwaI/AAAAAAAAUrE/OdfcHjoYCmIzBsFQveqdugJtQVh4LpTGgCK4B/s1600/3.png" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-5Ujwy5a9kx4/WIACbX8pwaI/AAAAAAAAUrE/OdfcHjoYCmIzBsFQveqdugJtQVh4LpTGgCK4B/s1600/3.png" /></a></div>grendel-a, grendel-b, etc. &nbsp;Makes it easy to keep the computers straight. After you've entered the hostname as above, press [enter].<br /><div style="text-align: center;"><a href="http://2.bp.blogspot.com/-2UkWNRKRJt0/WIACjjz1ETI/AAAAAAAAUrM/WK3E7OFTe_Unw5Nmp7LEyqUetN3t03XXACK4B/s1600/4.png" imageanchor="1"><img border="0" src="https://2.bp.blogspot.com/-2UkWNRKRJt0/WIACjjz1ETI/AAAAAAAAUrM/WK3E7OFTe_Unw5Nmp7LEyqUetN3t03XXACK4B/s1600/4.png" /></a></div>I'm using the same thing for the full name and the username. &nbsp;Makes it simple. Press [enter].<br /><div style="text-align: center;"><a href="http://2.bp.blogspot.com/-JjjcgEuQrJU/WIACnSkecqI/AAAAAAAAUrU/Z4u228SuNZEjDFMalCqXyqdjoTNF8DBZACK4B/s1600/5.png" imageanchor="1"><img border="0" src="https://2.bp.blogspot.com/-JjjcgEuQrJU/WIACnSkecqI/AAAAAAAAUrU/Z4u228SuNZEjDFMalCqXyqdjoTNF8DBZACK4B/s1600/5.png" /></a></div>Since the username is the same as the full name, just press [enter].<br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-8TQNWFo1zLc/WIACsNKiOTI/AAAAAAAAUrc/RvjgzfYsB1cqDmbPX4m93JcAHBgQYG6zQCK4B/s1600/6.png" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-8TQNWFo1zLc/WIACsNKiOTI/AAAAAAAAUrc/RvjgzfYsB1cqDmbPX4m93JcAHBgQYG6zQCK4B/s1600/6.png" /></a></div>That's the standard password for the computers. &nbsp;I used the [down arrow] and pressed [space] to select that radio button and show the password. &nbsp;Just press [enter]. &nbsp;It'll ask you to reenter the password for verification; do so, and press [enter] again.<br /><div style="text-align: center;"><a href="http://2.bp.blogspot.com/-4ZoNkvx4B68/WIACvljFxVI/AAAAAAAAUrk/bpPJMuwQ5NgzssRPItGtG56acZ4c_d2dwCK4B/s1600/7.png" imageanchor="1"><img border="0" src="https://2.bp.blogspot.com/-4ZoNkvx4B68/WIACvljFxVI/AAAAAAAAUrk/bpPJMuwQ5NgzssRPItGtG56acZ4c_d2dwCK4B/s1600/7.png" /></a></div>Don't bother with encryption; this is a cluster designed for speed, and that just makes disk access slower. &nbsp;For the next screen, check your time zone. &nbsp;If it's wrong, the adjustment screen is pretty intuitive.<br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-TJP4euYg3MY/WIACzOc2WvI/AAAAAAAAUrs/-7FDT3F-9Xg7J9iwBexd2OP0tATKjsvrwCK4B/s1600/8.png" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-TJP4euYg3MY/WIACzOc2WvI/AAAAAAAAUrs/-7FDT3F-9Xg7J9iwBexd2OP0tATKjsvrwCK4B/s1600/8.png" /></a></div>Press [enter] here to go with the default option. &nbsp;You want to use the entire disk, and LVM could be useful (it's also an incredible pain). &nbsp;Press [enter] again on the next screen after verifying the destination for the install. &nbsp;It's probably the largest drive - the small one is probably your flash drive. <br /><br />It asks for confirmation; [right arrow] and [enter].<br /><div style="text-align: center;"><a href="http://3.bp.blogspot.com/-HT60lMSIMO0/WIAC6jvSM6I/AAAAAAAAUr0/deXJp4kbPuAIsxawTDJaPm1abhpb4b0GgCK4B/s1600/9.png" imageanchor="1"><img border="0" src="https://3.bp.blogspot.com/-HT60lMSIMO0/WIAC6jvSM6I/AAAAAAAAUr0/deXJp4kbPuAIsxawTDJaPm1abhpb4b0GgCK4B/s1600/9.png" /></a></div><div style="text-align: center;"></div>I like to use a standard size for the installation that leaves lots of room to spare for other things on the drives. &nbsp;Might be able to do some kind of shared network storage for the computations with the rest. &nbsp;If it lets you, go for 50.0 GB. &nbsp; [enter].<br /><br />Another confirmation. &nbsp;[right arrow]&nbsp;+ [enter].<br /><div style="text-align: center;"><a href="http://4.bp.blogspot.com/-8m3jetFYFVc/WIADE1zuMxI/AAAAAAAAUsA/-laENdC9PoMMRjTb9YLXi7F7L00JTxZXQCK4B/s1600/10.png" imageanchor="1"><img border="0" src="https://4.bp.blogspot.com/-8m3jetFYFVc/WIADE1zuMxI/AAAAAAAAUsA/-laENdC9PoMMRjTb9YLXi7F7L00JTxZXQCK4B/s1600/10.png" /></a></div><br />Unless you have weird internet, leave this blank and press [enter]. &nbsp;If you do have a weird internet setting, then I can't help you.<br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-SIEddhZyEFE/WIADPoeA0AI/AAAAAAAAUsI/2CbrmtzVKdE83kEeml36DmqfUhMqaUNYACK4B/s1600/11.png" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-SIEddhZyEFE/WIADPoeA0AI/AAAAAAAAUsI/2CbrmtzVKdE83kEeml36DmqfUhMqaUNYACK4B/s1600/11.png" /></a></div><div style="text-align: center;"></div>I skipped the auto updates, since they won't positively impact the performance of the cluster, and might slow it down at times.<br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/-XHzCDcBLpjY/WIADR_93dDI/AAAAAAAAUsQ/kFoJA5uTjqE2tGX9qrLwU_gJc5M1tDr3QCK4B/s1600/12.png" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-XHzCDcBLpjY/WIADR_93dDI/AAAAAAAAUsQ/kFoJA5uTjqE2tGX9qrLwU_gJc5M1tDr3QCK4B/s1600/12.png" /></a></div>Ok, this is the one that really matters. &nbsp;<b>Addendum: also select 'Manual Package Selection'. &nbsp;For some machines with obscure drivers, this seems to ensure the drivers get installed. &nbsp;</b>You need the OpenSSH server in order to communicate with your cluster via the terminal. (at least, I'm pretty sure you do. &nbsp;I didn't want to spend the time to find out for sure.) &nbsp;[arrow down] to it, then [space] to select. &nbsp;[enter] to move on.<br /><div style="text-align: center;"><a href="http://4.bp.blogspot.com/-NdCVrNbMMU8/WIADU4UupSI/AAAAAAAAUsY/ylx6BrqPGBstuKReub5MOEiDcYnRwClowCK4B/s1600/13.png" imageanchor="1"><img border="0" src="https://4.bp.blogspot.com/-NdCVrNbMMU8/WIADU4UupSI/AAAAAAAAUsY/ylx6BrqPGBstuKReub5MOEiDcYnRwClowCK4B/s1600/13.png" /></a></div>Yes; you want <a href="https://en.wikipedia.org/wiki/GNU_GRUB" target="_blank">GRUB</a> installed to the MBR. &nbsp;[enter].<br /><div style="text-align: center;"><a href="http://4.bp.blogspot.com/-Nc2k89Xm69c/WIADXZzUsNI/AAAAAAAAUsg/ICrSUqC7T44PFCieN5vmXJVOoYqjBc7NwCK4B/s1600/14.png" imageanchor="1"><img border="0" src="https://4.bp.blogspot.com/-Nc2k89Xm69c/WIADXZzUsNI/AAAAAAAAUsg/ICrSUqC7T44PFCieN5vmXJVOoYqjBc7NwCK4B/s1600/14.png" /></a></div>...and that's it. &nbsp;Reboot, remove the flash drive, and the new OS is installed. <br /><h4>Final Adjustment: power management</h4><div>There is one more thing, though: you'll be running a bunch of these computers in the cluster, and you don't want to have to deal with them individually. &nbsp;For one thing, that would be a huge mess. &nbsp;So to keep them consolidated, you'll want to keep their lids shut while they're running: and if you don't change a setting, they'll just go to sleep when you close the lid. &nbsp;<a href="http://askubuntu.com/a/594417" target="_blank">src</a>.&nbsp;</div><div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">sudo nano /etc/systemd/logind.conf</pre></div><div>Find the line:</div><div><div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">#HandleLidSwitch=suspend</pre></div></div><div>and change it to:</div><div><div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">HandleLidSwitch=ignore</pre></div></div><div>Then restart that bit of the system:</div><div><div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">sudo service systemd-logind restart</pre></div></div><h3>Assembling the Cluster Hardware</h3>This is pretty straightforward: start with your ethernet switch. <br /><ol><li>Run a cable from your router to the #1 port on the switch.</li><li>Run a cable from each computer in the cluster to a port on the switch. &nbsp;I'm not going to try and correlate port numbers and computer numbers. &nbsp;Pretty sure it doesn't matter.</li></ol><div>And that's all it takes to assemble the cluster hardware! &nbsp;You should be able to ping your computers and get a response:</div><pre style="background-color: #eff0f1; border: 0px; color: #333333; font-size: 14px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">ping grendel-a</pre><div></div>If you don't get replies, you have a problem. &nbsp;Google is your friend. &nbsp;Worked for me.<br /><div><br /></div>
    </article>

    <p class="extra-space"></p>
    <hr>
    <p class="extra-space"></p>

</div>





      </section>
      <footer>
        <p><small>Hosted on GitHub &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a> and <a href="https://github.com/umhau">umhau</a></small></p>
      </footer>
    </box>
    <script src="/assets/js/scale.fix.js"></script>


  



  </body>
</html>
