<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">


    <link rel="stylesheet" type="text/css" href="/assets/css/styles.css">
    <meta name="viewport" content="width=device-width">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/js/infinite-jekyll.js"></script>

  </head>
  <body>
    <box class="wrapper">
      <header>
        <a href="http://localhost:4000"> <h1>*nixing around</h1> </a>
        <p>A programmer's journal of complicated projects.</p>
        <p class="view"><a href="">github</a> | <a href="http://localhost:4000/about">about</a> | <a href="http://localhost:4000/explore">explore</a></p>

        <p>testing</p>

      </header>
      <section>

      <div class="post">

    <header class="post-header">
        
    <h1 class="post-title">NFS server on OpenBSD</h1>
    <p 
        class="post-meta">Feb 1, 2017 • <a  href="/2017/02/01/nfs-server-on-openbsd/">permalink</a>
        <i>  • NFS • OpenBSD • LAN</i> 
    </p>
    </header>

    <article class="post-content">
    I still use OpenBSD for my server, so here goes setting up an NFS on it. &nbsp;<a href="https://www.openbsd.org/faq/faq6.html#NFS" target="_blank">This</a> is a fantastic resource.<br /><br />Note: if having trouble with the vi text editor, I listed a few simple commands elsewhere on the blog. &nbsp;For now, a few quick reminders:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">i        --&gt;       enters Insert mode (where you can enter text)<br />[ESC]    --&gt;       enters command mode<br />:w       --&gt;       saves the file (have to be in command mode)<br />:q       --&gt;       exits the file (have to be in command mode)</span></span><span style="color: #333333; font-size: 14px;"><br /></span></pre><div style="text-align: justify;"><br /></div>Let's call the shared folder 'storage'. &nbsp;We'll put it in the home directory of the user 'admin'. &nbsp;We have to create the user, and the folder. <br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">useradd -b /home/faculty/ -s /bin/bash -m admin<br />passwd admin</span></span></pre>Let's use the password<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">Password!</span></span></pre>since this is a local machine, and I'm assuming that the folks on the LAN are friendly.<br /><br />Next, make sure the new user owns their home directory.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">chown -R admin: admin</span></span></pre>And then create the shared directory inside /home/admin,<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">mkdir /home/admin/storage</span></span></pre>and make sure that everyone can read/write to that spot.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">chmod -R 777 /home/admin/storage</span></span></pre>I think nfs can be activated by adding the following to rc.conf.local. (<a href="https://www.safaribooksonline.com/library/view/absolute-openbsd-2nd/9781457172496/the_openbsd_nfs_server.html" target="_blank">src</a>; might not be updated, and I can't see more than the first bit)<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">vi /etc/rc.conf.local</span></span></pre>add to the end of the file:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">portmap=YES<br />nfs_server=YES</span></span></pre>OR, I can run these two commands. &nbsp;There's this thing about multiple server instances, so that I can handle concurrent requests, that I can control with the following commands...I just don't know if the services will be enabled after a reboot.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">rcctl enable portmap mountd nfsd<br />rcctl set nfsd flags -tun 4</span></span></pre>Once the services are started, the /etc/exports file needs an entry. &nbsp;This is how the machine knows to share the folder - and who to share it to.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">vi /etc/exports</span></span></pre>add to the bottom (this gives everyone accessing the folder root access),<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">/home/admin/storage -alldirs -mapall=root</span></span></pre>Now the nfs service can be started<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">rcctl start portmap mountd nfsd</span></span></pre>and in case you edited the /etc/exports file while the NFS was running, restart the service.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">rcctl reload mountd</span></span></pre><h4>Mount</h4><div>to mount the new network folder, you have to create your own location for the folder to present itself, and then set the folder to automount.</div><div><br /></div><div>Also, don't forget to install the nfs software. &nbsp;It came default on OpenBSD, but not so much on Linux Mint.</div><div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo apt-get install nfs-server -y</span></span></pre></div><div>create /storage in the root directory</div><div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo mkdir /storage</span></span></pre></div><div>give everyone all permissions</div><div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">chmod 777 /storage</span></span></pre></div><div>edit the fstab to automount the folder - we'll assume the hostname of the OpenBSD server is 'server1'</div><div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo nano /etc/fstab</span></span></pre></div><div>and add this to the bottom of the file</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">server1:/home/admin/storage     /storage  nfs </span></span></pre>and remount everything<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo mount -a</span></span></pre>that's it! &nbsp;You should have full access to the network folder.
    </article>

    <p class="extra-space"></p>
    <hr>
    <p class="extra-space"></p>

</div>





      </section>
      <footer>
        <p><small>Hosted on GitHub &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a> and <a href="https://github.com/umhau">umhau</a></small></p>
      </footer>
    </box>
    <script src="/assets/js/scale.fix.js"></script>


  



  </body>
</html>
