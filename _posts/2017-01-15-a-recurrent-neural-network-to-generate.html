---
layout: post
title: 'A Recurrent Neural Network to generate sentences: step-by-step assembly (Mint
  version)'
date: '2017-01-15T02:35:00.000-05:00'
author: umhau
tags:
- Linux Mint 18
- CPU
- DATA
- torch
- neural network
- word-rnn
- lua
- rnn
modified_time: '2017-01-24T19:11:56.908-05:00'
blogger_id: tag:blogger.com,1999:blog-2584289275272726799.post-5852192575547418600
blogger_orig_url: http://nixingaround.blogspot.com/2017/01/a-recurrent-neural-network-to-generate.html
---

This one predicts (ok, procedurally generates) text word-by-word. &nbsp;Others do it letter-by-letter, but then you have to deal with misspellings. &nbsp;<a href="https://github.com/larspars/word-rnn" target="_blank">src</a>. <a href="https://larseidnes.com/2015/10/13/auto-generating-clickbait-with-recurrent-neural-networks/" target="_blank">Inspiration</a>.<br /><h4>Dependencies</h4>I'm basing this off an installation script referenced in the github readme (<a href="https://raw.githubusercontent.com/torch/ezinstall/master/install-deps" target="_blank">here</a>). &nbsp;Instead of blindly running the script, I checked its contents and discovered it fails when run on linux mint. &nbsp;So I simplified it, and changed/added a thing or two since it wasn't working anyway. &nbsp;In case anyone wants to blindly run my version, <a href="https://raw.githubusercontent.com/umhau/misc-tools/master/dependencies.sh" target="_blank">here it is</a> all cleaned up.<br /><br />Updating your sources is always a good idea prior to installing a bunch of software. &nbsp;Also, the package below makes it easy to add new repositories (see below).<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;">sudo apt-get update<br />sudo apt-get install -y python-software-properties</pre>Now things are getting serious. &nbsp;This stuff includes GCC 4.9, since it seems GCC 5 isn't compatible with Torch 7. &nbsp;There was a weird error where cmake wasn't installed when I put all the packages in the same apt-get install command - I split out the packages to their own lines, ran my install script again, and it worked. &nbsp;Very odd. &nbsp;Hence, my inefficient code below.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo apt-get install -y build-essential <br />sudo apt-get install -y gcc <br />sudo apt-get install -y g++ <br />sudo apt-get install -y curl <br />sudo apt-get install -y cmake <br />sudo apt-get install -y libreadline-dev <br />sudo apt-get install -y git-core <br />sudo apt-get install -y libqt4-core <br />sudo apt-get install -y libqt4-gui <br />sudo apt-get install -y libqt4-dev <br />sudo apt-get install -y libjpeg-dev <br />sudo apt-get install -y libpng-dev <br />sudo apt-get install -y ncurses-dev <br />sudo apt-get install -y imagemagick <br />sudo apt-get install -y libzmq3-dev <br />sudo apt-get install -y gfortran <br />sudo apt-get install -y unzip <br />sudo apt-get install -y gnuplot <br />sudo apt-get install -y gnuplot-x11 <br />sudo apt-get install -y ipython<br />sudo apt-get install -y libpcre3-dev</span></span></pre>These are for a program called OpenBLAS, which stands for Basic Linear Algebra Subprograms. &nbsp;<a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms" target="_blank">Here's</a> a bit more on the concept.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo apt-get install -y libopenblas-dev liblapack-dev</span></span></pre>Install Torch (finally). &nbsp;Note that when running the ./install.sh command, I'm letting bash automatically enter "Y" when prompted for a user response. &nbsp;It's requesting permission to add torch to the system path in the .bashrc: essentially, creating a system shortcut for each initialization of the bash terminal.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">git clone https://github.com/torch/distro.git ~/torch --recursive<br />cd ~/torch; <br />echo "Y" | ./install.sh <br />source ~/.bashrc</span></span></pre>These tools are installed with Lua, a programming language that came with Torch. <br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">/home/$USER/torch/install/bin/luarocks install nngraph<br />/home/$USER/torch/install/bin/luarocks install nninit <br />/home/$USER/torch/install/bin/luarocks install optim<br />/home/$USER/torch/install/bin/luarocks install nn<br />/home/$USER/torch/install/bin/luarocks install underscore.lua --from=http://marcusirven.s3.amazonaws.com/rocks/<br />sudo /home/$USER/torch/install/bin/luarocks install lrexlib-pcre PCRE_DIR=/lib/x86_64-linux-gnu/ PCRE_LIBDIR=/lib/x86_64-linux-gnu/ </span></span></pre>Make sure to add Torch to your PATH. &nbsp;This ensures that when you run the command to use Torch, your computer can actually find the program. <br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">to_path="/home/$USER/torch/install/bin"<br />echo "PATH=$PATH:$to_path" &gt;&gt; /home/$USER/.bashrc<br />source ~/.bashrc</span></span></pre>With that, all dependencies should be satisfied. Time to install. <br /><h4>Installation</h4><div>Clone the software from github.</div><div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">mkdir ~/projects<br />cd projects<br />git clone https://github.com/larspars/word-rnn.git</span></span></pre></div>That's actually all there is to it. &nbsp;Now cd into the word-rnn directory to run the test stuff. &nbsp;Before the tests and tools, though, there's a fix that you have to perform.<br /><h4>Extra Fixes</h4><div>I'm running torch on a gpu-less computer. &nbsp;There's a glitch that occurs when running the test script in that scenario. &nbsp;To avert it, you have to change the name of a function from CudaTensor to Tensor. &nbsp;See <a href="https://github.com/larspars/word-rnn/issues/14#issuecomment-203663207" target="_blank">here</a> for details. &nbsp;</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">cd word-rnn/util<br />nano SharedDropout.lua</span></span></pre>The third line should look like this:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">SharedDropout_noise = torch.CudaTensor()</span></span></pre>Change it to this:<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">SharedDropout_noise = torch.Tensor()</span></span></pre>And save.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">CTRL + O<br />CTRL <complete id="goog_1128259466">+ </complete>X</span></span></pre><h4>Running word-rnn</h4>Now you can run the test function. &nbsp;Be aware that on a 4-core 2.8GHz i7 processor, this command took 21 hours to complete. &nbsp;BUT it's a very cool command, and the result is amazing.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">th train.lua -gpuid -1</span></span></pre>To be continued...<br /><br />