---
layout: post
title: "(Internet via Ethernet) + (SSH via wireless)"
date: '2017-01-26T13:15:00.002-05:00'
author: umhau
tags:
- ssh
- Linux
- DHCP
- ethernet
- MPICH
- wireless access point
- AP
- Ubuntu Server 16.04.1 LTS
- wifi
- hostapd
modified_time: '2017-02-01T18:17:45.503-05:00'
blogger_id: tag:blogger.com,1999:blog-2584289275272726799.post-689342142474356961
blogger_orig_url: http://nixingaround.blogspot.com/2017/01/internet-via-ethernet-ssh-via-wireless.html
---

<div style="text-align: center;">= (sustained SSH during MPICH computing)</div><div style="text-align: left;"><br /></div><div style="text-align: left;">I've been losing SSH connection after starting process jobs on my new beowulf cluster. &nbsp;This is my current fix, since my theory is that the network switch is so clogged with MPI-related communication (which does take place via ssh) that there's no bandwidth left for my administrative SSH connection. &nbsp;Theory supported by observation that when I plug my unrelated control machine into the switch it can't ping google.</div><h4 style="text-align: left;">assumptions</h4><div><ul><li>Ubuntu 16.04.1 LTS</li><li>working wireless <i>and</i> ethernet: I had to do <a href="https://nixingaround.blogspot.com/2017/01/when-ubuntu-server-doesnt-let-you-keep.html" target="_blank">this</a> and&nbsp;<a href="https://nixingaround.blogspot.com/2017/01/ubuntu-server-1604-not-detecting-wifi.html" target="_blank">this</a>.</li></ul></div><h4 style="text-align: left;">sources</h4><div style="text-align: left;"><a href="https://web.archive.org/web/20140307210607/http://www.themagpi.com/issue/issue-11/article/turn-your-raspberry-pi-into-a-wireless-access-point">https://web.archive.org/web/20140307210607/http://www.themagpi.com/issue/issue-11/article/turn-your-raspberry-pi-into-a-wireless-access-point</a><br /><a href="http://askubuntu.com/a/180734">http://askubuntu.com/a/180734</a><br /><a href="https://seravo.fi/2014/create-wireless-access-point-hostapd">https://seravo.fi/2014/create-wireless-access-point-hostapd</a></div><h4 style="text-align: left;">check wifi hardware capability</h4><div style="text-align: left;">Run the command&nbsp;</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">iw list</span></span></pre><div style="text-align: left;">And look for a section like the following. &nbsp;If it includes 'AP' (see emboldened bit), you're golden. &nbsp;If not, look for a different wireless card.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">Supported interface modes:  <br />         * IBSS <br />         * managed  <br />        <b> * AP </b><br />         * AP/VLAN  <br />         * monitor </span></span><span style="color: #333333; font-size: 14px;"><br /></span></pre><h4 style="text-align: justify;">install dependencies</h4><div style="text-align: justify;"><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo apt-get install rfkill hostapd hostap-utils iw dnsmasq   </span></span></pre></div><h4 style="text-align: left;">identify interface names</h4><div style="text-align: left;">As of ubuntu 16.04, the standard wlan0 and eth0 interface names are no longer in use. &nbsp;You'll have to identify them specifically. &nbsp;Use the following command, which lists the contents of the folder for each interface device, and look for the device that has a folder named 'wireless'. <a href="http://askubuntu.com/a/845520" target="_blank">src</a>.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">ls /sys/class/net/*</span></span></pre><div style="text-align: left;">Observe the assumptions above to see what I'm calling them.</div><h3 style="text-align: left;">configure wifi settings</h3><div style="text-align: left;">There's three files you'll have to configure. &nbsp;Since I'm logged in via ssh, I don't want to interrupt my connection until I've created a new access point I can connect to. &nbsp;So I'll walk through editing each file in turn, then I'll have one command at the end that activates all the changes. &nbsp;</div><h4 style="text-align: left;">configure wireless interface: /etc/network/interfaces</h4><div style="text-align: left;">Backup your current interface file.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo cp /etc/network/interfaces /etc/network/interfaces.bak</span></span></pre><div style="text-align: left;">and then edit the original</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo nano /etc/network/interfaces</span></span></pre><div style="text-align: left;">replace the contents of the file - change the interface names as appropriate.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">auto lo<br />iface lo inet loopback<br /><br />auto enp2s0<br />iface enp2s0 inet dhcp<br /><br />auto wlp1s0<br />iface wlp1s0 inet static<br />hostapd /etc/hostapd/hostapd.conf<br />address 192.168.3.14<br />netmask 255.255.255.0</span></span></pre><div style="text-align: left;">Normally I'd say that here's where you restart the interface, but we're saving that for the end.</div><h4 style="text-align: left;">configure the access point: /etc/hostapd/hostapd.conf</h4><div style="text-align: left;">backup the original file - it's ok if there's nothing there.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo cp /etc/hostapd/hostapd.conf /etc/hostapd/hostapd.conf.bak</span></span></pre><div style="text-align: left;">edit the original</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo nano /etc/hostapd/hostapd.conf</span></span></pre><div style="text-align: left;">put this in:</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">interface=wlp1s0<br />driver=nl80211<br />ssid=test<br />hw_mode=g<br />channel=1<br />macaddr_acl=0<br />auth_algs=1<br />ignore_broadcast_ssid=0<br />wpa=3<br />wpa_passphrase=1234567890<br />wpa_key_mgmt=WPA-PSK<br />wpa_pairwise=TKIP<br />rsn_pairwise=CCMP</span></span></pre><div style="text-align: left;">Inexplicably, this only seems to produce a detectable wifi access point when the ssid is 'test'. &nbsp;I tried several other non-keyword names, and none of them worked. &nbsp;Go back to 'test', and it worked. &nbsp;Did it several times...magic.<br /><br />Save and exit.</div><h4 style="text-align: left;">configure the DHCP server</h4><div style="text-align: left;">this is where the access point actually becomes something you can access. backup:&nbsp;</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak</span></span></pre><div style="text-align: left;">edit original - since the file is <i>so</i>&nbsp;big, I rm'd the original and pasted the contents below into an empty file.<br /><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo rm /etc/dnsmasq.conf<br />sudo nano /etc/dnsmasq.conf</span></span></pre>make it look like this:</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;"># Never forward plain names (without a #dot or domain part)<br />domain-needed<br /><br /># Only listen for DHCP on wlan0<br />interface=wlp1s0<br /><br /># create a domain if you want, comment #it out otherwise<br /># domain=Pi-Point.co.uk<br /><br /># Create a dhcp range on your /24 wlp1s0 #network with 12 hour lease time<br />dhcp-range=192.168.3.15,192.168.3.254, 255.255.255.0,12h</span></span></pre><div style="text-align: left;">Save and exit.</div><h3 style="text-align: left;">implement changes</h3><div style="text-align: left;">this is going to be one big command. if it works, you're in business...if it doesn't, you'll have to login directly to the machine for troubleshooting.</div><pre style="background-color: #eff0f1; border: 0px; margin-bottom: 1em; overflow: auto; padding: 5px; text-align: justify; width: auto; word-wrap: normal;"><span style="color: #333333;"><span style="font-size: 14px;">sudo ifdown wlp1s0; sudo ifup wlp1s0; sudo service hostapd restart; sudo service dnsmasq restart</span></span></pre><div style="text-align: left;">Worked for me: I now have a secondary wireless access to my beowulf cluster for when the ethernet gets clogged with MPI signals.<br /><br /><br /><br /></div>